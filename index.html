<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>खुला शहर गेमप्ले – Corrector सिस्टम</title>
<style>
body{margin:0;overflow:hidden;background:#87ceeb;}
canvas{display:block;}
#hud{
position:fixed;left:10px;top:10px;
color:#fff;font-family:Arial;
background:rgba(0,0,0,.4);
padding:8px;border-radius:6px;
}
#genderBox{
position:fixed;right:10px;top:10px;
background:rgba(0,0,0,.4);
padding:8px;border-radius:6px;
color:#fff;
}
button{margin:2px;}
</style>
</head>
<body>

<div id="hud">
स्वास्थ्य: <span id="hp">100</span>
</div>

<div id="genderBox">
खिलाड़ी चुनें:<br>
<button onclick="setGender('male')">Male</button>
<button onclick="setGender('female')">Female</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* SCENE */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

/* CAMERA */
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,500);
camera.position.set(0,3,6);

/* RENDERER */
const renderer=new THREE.WebGLRenderer({antialias:false});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.25));
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

/* LIGHTS */
scene.add(new THREE.HemisphereLight(0xffffff,0x444444,0.6));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(50,100,50);
sun.castShadow=true;
scene.add(sun);

/* GROUND */
const ground=new THREE.Mesh(
new THREE.PlaneGeometry(500,500),
new THREE.MeshStandardMaterial({color:0x3a3a3a})
);
ground.rotation.x=-Math.PI/2;
ground.receiveShadow=true;
scene.add(ground);

/* LOADER & DATA */
const loader=new THREE.GLTFLoader();
let controlled=null;
let currentGender=null;
const correctors=[];

/* GENDER SET FUNCTION */
function setGender(type){
if(currentGender===type) return;

if(controlled){
scene.remove(controlled);
controlled=null;
}

currentGender=type;
const file = type==="male" ? "player_male.glb" : "player_female.glb";

loader.load(file,gltf=>{
controlled=gltf.scene;
controlled.scale.setScalar(1);
scene.add(controlled);
});
}

/* ADD CORRECTOR (STATIC) */
function addCorrector(pos){
loader.load("corrector.glb",gltf=>{
const npc=gltf.scene;
npc.position.copy(pos);
npc.userData.isCorrector=true;
scene.add(npc);
correctors.push(npc);
});
}

addCorrector(new THREE.Vector3(5,0,5));
addCorrector(new THREE.Vector3(-6,0,3));

/* RESIZE */
addEventListener("resize",()=>{
camera.aspect=innerWidth/innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(innerWidth,innerHeight);
});

/* LOOP */
function animate(){
requestAnimationFrame(animate);

/* CAMERA FOLLOW PLAYER */
if(controlled){
camera.position.lerp(
new THREE.Vector3(
controlled.position.x,
controlled.position.y+3,
controlled.position.z+6
),0.1);
camera.lookAt(controlled.position);
}

renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
